(()=>{"use strict";let e=null;chrome.runtime.onMessage.addListener(((t,s,o)=>{const{action:a,jobData:n,chatMessage:r}=t;return"openChatPage"===a?(async(t,s,o)=>{const{encryptBossId:a,encryptJobId:n,securityId:r,lid:c}=t;e||(e=await new Promise((e=>{chrome.windows.create({url:"about:blank",type:"normal",state:"minimized"},(t=>e(t.id)))})));const i=await new Promise((t=>{chrome.tabs.create({windowId:e,url:`https://www.zhipin.com/web/geek/chat?id=${a}&jobId=${n}&securityId=${r}&lid=${c}`},(e=>t(e.id)))})),d=(e,t)=>{e===i&&"complete"===t.status&&(chrome.tabs.onUpdated.removeListener(d),chrome.scripting.executeScript({target:{tabId:i},func:async e=>{const t=e=>document.querySelector(e),s=e=>new Promise((t=>setTimeout(t,e)));await s(500);const[o,a,n]=[t("#chat-input"),t(".emoj.emoj-1"),t(".chat-op .btn-send")];return o&&a&&n?(a.click(),await s(100),o.innerText=e,await s(100),n.click(),await(r=()=>{var e;const t=null===(e=Array.from(document.querySelectorAll(".item-myself .message-text .status")).pop())||void 0===e?void 0:e.classList;return(null==t?void 0:t.contains("status-delivery"))||(null==t?void 0:t.contains("status-read"))},new Promise((e=>{let t=0;const s=setInterval((()=>{const o=()=>{clearInterval(s),e(t)};t++;try{(r()||t>30)&&o()}catch(e){o(),console.error("inspectTimer 出错",e)}}),100)}))),await s(200),{status:"success",msg:"发送消息完成"}):{status:"error",msg:"发送消息失败"};var r},args:[s]},o))};chrome.tabs.onUpdated.addListener(d)})(n,r,o):"closeWindow"===a&&e&&chrome.windows.remove(e,(()=>{e=null})),!0})),chrome.windows.onRemoved.addListener((t=>{t===e&&(e=null)}))})();